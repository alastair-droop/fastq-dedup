# FASTQ File Deduplication

Thee scripts inspect a directory for all FASTQ files (compressed and uncompressed) to identify possible duplicates.

FASTQ file metadata is generated by the `fastq-id` script; groups of possible duplicates are identified by the `fastq-duplicates` script

## `fastq-id`

This script walks over a directory extracting metadata from all FASTQ files.

~~~
usage: fastq-id [-h] [-v] [-V {error,warning,info,debug}] [-r] [-l] [-c]
                [-e EXTENSIONS] [-b BLOCK_SIZE] [-o OUTPUT_FILE]
                [<directory> [<directory> ...]]

Generate identification data for FASTQ files

positional arguments:
  <directory>           folder(s) to search

optional arguments:
  -h, --help            show this help message and exit
  -v, --version         show program's version number and exit
  -V {error,warning,info,debug}, --verbose {error,warning,info,debug}
                        Set logging level
  -r, --recursive       recursively search folders
  -l, --follow-links    follow links (if running recursively)
  -c, --checksum        generate file checksums & decompressed size
  -e EXTENSIONS, --extension EXTENSIONS
                        file extensions to search
  -b BLOCK_SIZE, --md5-block-size BLOCK_SIZE
                        file block size for calculating checksums
  -o OUTPUT_FILE, --output-file OUTPUT_FILE
                        output file
~~~

The `fastq-id` script generates a JSON-formatted file containing the metadata for each processed file. Values that were either not tested or which could not be extracted are marked as `null`.

The extracted metadata attributes are:

* **`dir`**: The directory containing the examined file;
* **`name`**: The examined file name;
* **`format`**: The format of the file [`fastq` | `fastq.gz`];
* **`disk`**: The size of the file on disk (in bytes);
* **`size`**: The size of the data in the file (in bytes);
* **`checksum`**: The MD5 checksum of the data in the file; and
* **`header`**: The first read header in the file

**NB:** The `size` and `checksum` values both refer to the uncompressed file (thus, a `fastq` and `fastq.gz` file containing the same data will have identical `size` and `checksum` attributes, but a different `disk` attribute).

## `fastq-duplicates`

This script processes the JSON-formatted output from the `fastq-id` script to identify groups of possibly duplicated files.

~~~
usage: fastq-duplicates [-h] [-v] [-V {error,warning,info,debug}]
                        [-c {certain,likely,possible}] [-o OUTPUT_FILE]
                        input_file

Identify possible duplicate FASTQ files from JSON data generated by fastq-id

positional arguments:
  input_file            input FASTQ data JSON file file

optional arguments:
  -h, --help            show this help message and exit
  -v, --version         show program's version number and exit
  -V {error,warning,info,debug}, --verbose {error,warning,info,debug}
                        Set logging level
  -c {certain,likely,possible}, --certainty-level {certain,likely,possible}
                        certainty level for reporting
  -o OUTPUT_FILE, --output-file OUTPUT_FILE
                        output file
~~~

4 different grouping methods are performed:

### Certain Duplicates

Files that share a decompressed `checksum` contain identical data and are therefore certainly duplicates.

### Likely Duplicates

Files that share (`size` and `header`) or (`disk` and `header`) are likely duplicated (as they have the same first read which should limit to the same flowcell, lane, index and pair, and are the same size on disk). Both comparisons are performed, so that we are able to identify likely duplicates in the absence of `checksum` and `uncompressed` data, (which are very slow to compute).

### Possible Duplicates

Files that share the same `header` are possible duplicates, although care must be taken here as FASTQ processing methods often yield files with read headers unchanged.
